---
title: "Meade 4000 Filter"
author: "Ralph Rogge (RRO)"
date: "17. Februar 2016"
output: 
    html_document:
        fig_width: 10
        fig_height: 6
---

Set this flag to TRUE when you want to write out plot.
```{r}
write.plot.enabled = F
```


```{r, message=FALSE}
library(data.table)
library(ggplot2)
```

Read Meade 4000 filter data from files
```{r}
read.filter <- function(name,code) {
  df <- read.csv(name, col.names=c("w","transmission","X"))[,1:2]
  df$code <- code
  df
}

filter <- read.filter("Meade 4000 Filter 8.csv","8")
filter <- rbind(filter, read.filter("Meade 4000 Filter 11.csv","11"))
filter <- rbind(filter, read.filter("Meade 4000 Filter 21.csv","21"))
filter <- rbind(filter, read.filter("Meade 4000 Filter 23A.csv","23A"))
filter <- rbind(filter, read.filter("Meade 4000 Filter 25A.csv","25A"))
filter <- rbind(filter, read.filter("Meade 4000 Filter 38A.csv","38A"))
filter <- rbind(filter, read.filter("Meade 4000 Filter 47.csv","47"))
filter <- rbind(filter, read.filter("Meade 4000 Filter 56.csv","56"))
filter <- rbind(filter, read.filter("Meade 4000 Filter 58.csv","58"))
filter <- rbind(filter, read.filter("Meade 4000 Filter 80A.csv","80A"))
filter <- rbind(filter, read.filter("Meade 4000 Filter 82A.csv","82A"))
```

Plot order
```{r}
filter.codes <- factor(filter$code, levels=c("8",   "11",  "21", 
                                            "23A", "25A", "38A", 
                                            "47",  "56",  "58", 
                                            "80A", "82A"))
```

Colors used for filter plots
```{r}
filter.colors <- c("yellow",       "yellowgreen", "orange", 
                   "red",          "red3",        "blue", 
                   "purple",       "green",       "green3", 
                   "deepskyblue3", "skyblue")

```

Labels used for filter plots
```{r}
filter.labels <- c("#8",           "#11",        "#21", 
                   "#23A",         "#25A",       "#38A", 
                   "#47",          "#56",        "#58", 
                   "#80A",         "#82A")

```

Function used to write plot to PNG file
```{r}
write.plot <- function(p, filename, width=1024, height=576, font.size=16) {
  png(filename,width, height)
  print(p + theme_bw(base_size=font.size))
  dev.off()
}
```

Plot transmission of Meade 4000 filters
```{r}

p <- ggplot(data=filter) +
  geom_line(aes(w,transmission,color=filter.codes)) +
  scale_colour_manual(name="Filter", values=filter.colors, labels=filter.labels) +
  labs(title="Meade 4000 Filter", x="Wavelength [nm]", y="Transmission [%]") +
  theme_bw() +
  coord_cartesian(xlim=c(250,800))
p

if (write.plot.enabled) write.plot(p, "Meade 4000 Filter.png")
```

Function to read vision data from file
```{r}
read.vision <- function(filename, type) {
  df <- read.csv(filename)
  df$type <- type
  df
}
```

Read data for scotopic and photopic vision from file
```{r}
vision <- read.vision("scvle.csv", "Scotopic")
vision <- rbind(vision, read.vision("vljve.csv", "Photopic"))
vision$type <- factor(vision$type, levels=c("Scotopic", "Photopic"))
```

Wavelength limits from photopic and scotopic vision
```{r}
w.min <- max(min(vision$w), 380)
w.max <- min(max(vision$w), 720)
```

Plot relative luminous efficency of photopic and scotopic visions
```{r}
p <- ggplot(data=vision) +
  geom_line(aes(x=w,y=v,color=type)) +
  scale_color_manual(name="Vision", values=c("black","grey70")) +
  labs(title="Photopic and Scotopic Vision", 
       x="Wavelength [nm]", 
       y="Relative Luminous Efficiency") +
  coord_cartesian(xlim=c(w.min,w.max)) +
  theme_bw()
p

if (write.plot.enabled) write.plot(p, "Photopic and Scotopic Vision.png")
```

```{r}
scotopic.vision <- subset(vision, type=="Scotopic")
scotopic.data <- filter
scotopic.data$v <- approx(scotopic.vision$w, scotopic.vision$v, scotopic.data$w, yleft=0, yright=0)$y
scotopic.data$f <- scotopic.data$transmission/100 * scotopic.data$v
scotopic.data$type <- "Scotopic"
```

Plot of filtered relative luminous efficiency for scotopic vision with Meade 4000 filter applied
```{r}
p <- ggplot(data=scotopic.data) +
  geom_line(aes(w, f, color=filter.codes)) +
  scale_colour_manual(name="Filter", values=filter.colors, labels=filter.labels) +
  labs(title="Scotopic Vision with Meade 4000 Filter", 
       x="Wavelength [nm]", 
       y="Filtered Relative Luminous Efficiency") +
  theme_bw() +
  coord_cartesian(xlim=c(w.min,w.max))
p

if (write.plot.enabled) write.plot(p, "Scotopic Vision using Meade 4000 Filter.png")
```

```{r}
photopic.vision <- subset(vision, type=="Photopic")
photopic.data <- filter
photopic.data$v <- approx(photopic.vision$w, photopic.vision$v, photopic.data$w, yleft=0, yright=0)$y
photopic.data$f <- photopic.data$transmission/100 * photopic.data$v
photopic.data$type <- "Photopic"
```

Plot of filtered relative luminous efficiency for photopic vision and Meade 4000 filter applied
```{r}
p <- ggplot(data=photopic.data) +
  geom_line(aes(w,f,color=filter.codes)) +
  scale_colour_manual(name="Filter", values=filter.colors, labels=filter.labels) +
  labs(title="Photopic Vision with Meade 4000 Filter", 
       x="Wavelength [nm]", 
       y="Filtered Relative Luminous Efficiency") +
  theme_bw() +
  coord_cartesian(xlim=c(w.min,w.max))
p

if (write.plot.enabled) write.plot(p, "Photopic Vision with Meade 4000 Filter.png")
```
